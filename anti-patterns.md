<div dir="rtl">

### **أنماط مضادة لاختبار القيادة بواسطة الاختبار (TDD)**

من وقت لآخر، من الضروري مراجعة تقنياتك في اختبار القيادة بواسطة الاختبار (TDD) وتذكير نفسك بالسلوكيات التي يجب تجنبها.

عملية TDD من المفهوم البسيط متابعتها، ولكن أثناء القيام بها، ستجد أنها تتحدى مهاراتك في التصميم. **لا تخلط بين هذا وبين صعوبة TDD، فالتصميم هو الصعب!**

يستعرض هذا الفصل عددًا من الأنماط المضادة لـ TDD والاختبار، وكيفية علاجها.

## عدم تطبيق TDD على الإطلاق

بالطبع، من الممكن كتابة برامج رائعة بدون TDD، ولكن العديد من المشاكل التي رأيتها في تصميم الكود وجودة الاختبارات كان من الصعب الوصول إليها إذا تم استخدام نهج منضبط لـ TDD.

إحدى نقاط قوة TDD هي أنها توفر لك عملية رسمية لتحليل المشكلات، وفهم ما تحاول تحقيقه (أحمر)، ثم إنجازه (أخضر)، ثم التفكير جيدًا في كيفية جعله صحيحًا (أزرق/إعادة الهيكلة).

بدون هذا، تكون العملية غالبًا عشوائية وفضفاضة، مما قد يجعل الهندسة أكثر صعوبة مما قد تكون عليه.

## سوء فهم قيود مرحلة إعادة الهيكلة

لقد كنت في العديد من ورش العمل أو جلسات العمل الزوجية أو الجماعية حيث قام شخص ما بتجاوز اختبار وأصبح في مرحلة إعادة الهيكلة. بعد التفكير، يعتقدون أنه سيكون من الجيد تجريد بعض الكود إلى هيكل جديد؛ فيصرخ أحد الأشخاص المتعصبين:

> لا يُسمح لك بفعل ذلك! يجب عليك كتابة اختبار أولاً، نحن نستخدم TDD!

يبدو أن هذا سوء فهم شائع. **يمكنك فعل ما تشاء في الكود عندما تكون الاختبارات خضراء**، الشيء الوحيد الذي لا يُسمح لك به هو **إضافة أو تغيير السلوك**.

الغرض من هذه الاختبارات هو منحك _الحرية لإعادة الهيكلة_، وإيجاد التجريدات الصحيحة، وجعل الكود أسهل للتغيير والفهم.

## وجود اختبارات لن تفشل (أو اختبارات دائمة)

من المدهش كيف أن هذا يحدث بشكل متكرر. تبدأ في تصحيح الأخطاء أو تغيير بعض الاختبارات وتدرك: لا توجد أي سيناريوهات حيث يمكن لهذا الاختبار أن يفشل. أو على الأقل، لن يفشل بالطريقة التي كان من المفترض أن يحمي منها الاختبار.

هذا _يكاد يكون مستحيلاً_ مع TDD إذا كنت تتبع **الخطوة الأولى**،

> اكتب اختبارًا، وشاهده يفشل

يحدث هذا تقريبًا دائمًا عندما يكتب المطورون الاختبارات _بعد_ كتابة الكود، و/أو يطاردون تغطية الاختبارات بدلاً من إنشاء مجموعة اختبارات مفيدة.

## التأكيدات غير المفيدة

هل عملت يومًا على نظام، وكسر اختبارًا، ثم رأيت هذا؟

> `false لا تساوي true`

أعرف أن false لا تساوي true. هذه ليست رسالة مفيدة؛ فهي لا تخبرني بما تم كسره. هذه هي إحدى أعراض عدم اتباع عملية TDD وعدم قراءة رسالة خطأ الفشل.

الرجوع إلى اللوحة، 

> اكتب اختبارًا، شاهده يفشل (ولا تخجل من رسالة الخطأ)

## التأكيد على التفاصيل غير ذات الصلة

مثال على ذلك هو إجراء تأكيد على كائن معقد، بينما في الواقع كل ما يهمك في الاختبار هو قيمة أحد الحقول.

</div>

```go
// ليس هذا، الآن اختبارك مرتبط بكائن كامل
if !cmp.Equal(complexObject, want) {
	t.Error("got %+v, want %+v", complexObject, want)
}

// كن محددًا، وقلل من الارتباط
got := complexObject.fieldYouCareAboutForThisTest
if got != want {
	t.Error("got %q, want %q", got, want)
}
```

<div dir="rtl">

التأكيدات الإضافية تجعل اختبارك أكثر صعوبة في القراءة عن طريق خلق "ضوضاء" في توثيقك، كما أنها ترتبط بالبيانات التي لا تهم الاختبار. هذا يعني أنه إذا قمت بتغيير الحقول لكائنك، أو طريقة سلوكها، قد تواجه مشاكل في الترجمة أو فشلًا في الاختبارات.

هذا مثال على عدم اتباع مرحلة الأحمر بشكل صارم بما فيه الكفاية.

- السماح لتصميم موجود بتأثير على كيفية كتابة الاختبار **بدلاً من التفكير في السلوك المطلوب**
- عدم إعطاء الاهتمام الكافي لرسالة خطأ الاختبار الفاشل

## الكثير من التأكيدات ضمن سيناريو واحد لاختبارات الوحدة

تجعل العديد من التأكيدات الاختبارات صعبة القراءة وصعبة التصحيح عند فشلها.

غالبًا ما تتسلل تدريجيًا، خاصة إذا كان إعداد الاختبار معقدًا لأنك لا ترغب في تكرار نفس الإعداد السيئ للتأكيد على شيء آخر. بدلاً من ذلك، يجب عليك إصلاح المشكلات في تصميمك التي تجعل من الصعب التأكيد على أشياء جديدة.

قاعدة thumb مفيدة هي محاولة جعل تأكيد واحد لكل اختبار. في Go، استغل الاختبارات الفرعية لتوضيح الفروق بين التأكيدات في الحالات التي تحتاج إليها. هذه تقنية مفيدة أيضًا لفصل التأكيدات على السلوك مقابل تفاصيل التنفيذ.

بالنسبة لاختبارات أخرى حيث قد تكون إعدادات أو وقت التنفيذ قيدًا (مثل اختبار القبول الذي يقود متصفح ويب)، يجب عليك موازنة إيجابيات وسلبيات الاختبارات التي يصعب تصحيحها مقابل وقت تنفيذ الاختبار.

## عدم الاستماع إلى اختباراتك

[ديف فارلي في الفيديو الخاص به "عندما يخطئ TDD"](https://www.youtube.com/watch?v=UWtEVKVPBQ0&feature=youtu.be) يشير إلى،

> TDD يمنحك أسرع ردود فعل ممكنة على تصميمك

من تجربتي الخاصة، يحاول العديد من المطورين ممارسة TDD ولكنهم غالبًا ما يتجاهلون الإشارات القادمة إليهم من عملية TDD. لذلك لا يزالون عالقين في أنظمة هشة، ومزعجة، مع مجموعة اختبارات ضعيفة.

ببساطة، إذا كان من الصعب اختبار الكود الخاص بك، فهذا يعني أن _استخدام_ الكود الخاص بك صعب أيضًا. تعامل مع اختباراتك باعتبارها أول مستخدم لكودك ثم سترى ما إذا كان الكود الذي كتبته سهل التعامل معه أم لا.

لقد أكدت على هذا كثيرًا في الكتاب، وسأقولها مرة أخرى: **استمع لاختباراتك**.

### إعداد مفرط، العديد من بدائل الاختبار، إلخ.

هل نظرت يومًا إلى اختبار يحتوي على 20 أو 50 أو 100 أو 200 سطر من كود الإعداد قبل أن يحدث أي شيء مثير في الاختبار؟ هل تجد نفسك بعد ذلك مضطرًا لتغيير الكود وإعادة زيارة هذا الفوضى وتمنى لو كان لديك مهنة مختلفة؟

ما هي الإشارات هنا؟ _استمع_، الاختبارات المعقدة `==` الكود المعقد. لماذا الكود معقد؟ هل يجب أن يكون؟

- عندما يكون لديك العديد من بدائل الاختبار في اختباراتك، فهذا يعني أن الكود الذي تختبره يحتوي على العديد من الاعتمادات - مما يعني أن تصميمك يحتاج إلى العمل.
- إذا كان اختبارك يعتمد على إعداد العديد من التفاعلات مع المحاكاة، فهذا يعني أن الكود الخاص بك يقوم بالعديد من التفاعلات مع اعتماده. اسأل نفسك إذا كان من الممكن جعل هذه التفاعلات أبسط.

#### الواجهات المتسربة

إذا كنت قد أعلنت `interface` تحتوي على العديد من الطرق، فهذا يشير إلى تجريد متسرب. فكر في كيفية تعريف هذا التعاون مع مجموعة أكثر تجميعًا من الطرق، ويفضل أن تكون واحدة فقط.

#### تلوث الواجهة

كما تقول حكمة Go، *كلما كانت الواجهة أكبر، كان التجريد أضعف*. إذا قمت بالكشف عن واجهة ضخمة لمستخدمي الحزمة الخاصة بك، فإنك تجبرهم على إنشاء اختبار تقريبي يتطابق مع كامل واجهة البرمجة، مما يوفر أيضًا تنفيذًا للطرق التي لا يستخدمونها (أحيانًا، يقتصرون على الانهيار لإظهار أنها لا ينبغي أن تستخدم). هذه الوضعية هي نمط مضاد يُعرف بـ [تلوث الواجهة](https://rakyll.org/interface-pollution/) وهذه هي السبب الذي جعل مكتبة Go القياسية تقدم لك واجهات صغيرة جدًا.

بدلاً من ذلك، يجب عليك عرض هيكل عادي مع جميع الطرق ذات الصلة التي تم تصديرها، مما يتيح لعملاء واجهتك الحرية في إعلان واجهاتهم الخاصة التي تجذب فقط الطرق التي يحتاجون إليها.
</div>
